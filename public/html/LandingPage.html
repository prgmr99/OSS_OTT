<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
    <link rel="stylesheet" href="../../src/css/LandingPage.css" />
    <title>OTT_Library</title>
</head>
<body>
    <div include-html="signIn.html"></div>
    <form class="search_form">
        <div class="search_bar">
            <input class="search_txt" type="text" name="keyword" value="">
            <button class="search_btn" type="submit">
                <img src="../../src/image/searchIcon.svg" alt="submit_btn">
            </button>
        </div>
        <div class="result">
            <ul class="result_contents">
            </ul>
        </div>
    </form>
    <div class="listview">
        <div class="seriesList">
            series list
        </div>
        <div class="movieList">
            movie list
        </div>
    </div>
    <a class="initial_userIcon" href="./SignInPage.html">
        <img src="../../src/image/UserIcon.svg" alt="userIcon" class="userIcon">
    </a>
</body>
<script type="module">
    const api_key = '6c616e9a21c6e51d1191f6fc4f2d11c4';
    const $search_form = document.querySelector('.search_form');
    const $search_txt = document.querySelector('.search_txt');
    const $result_contents = document.querySelector('.result_contents');
    const $seriesList = document.querySelector('.seriesList');
    const $movieList = document.querySelector('.movieList');
    const $fragment = document.createDocumentFragment();
    const movies = [];
    $search_form.onsubmit = e => {
        e.preventDefault();
        $result_contents.innerHTML = '';
        console.log($search_form.querySelector('input').value);
        render();
    };
    const getMovieList = async() => {
        try {
            const getMovie = await fetch(
                `https://api.themoviedb.org/3/movie/popular?api_key=${api_key}&language=en-US&page=1`
            );
            const { results } = await getMovie.json();
            results.forEach(content => {
                const $li = document.createElement('li');
                $li.id = content.id;
                $li.className = content.media_type;
                const $a = document.createElement('a');
                $a.href = '#';
                const $img = document.createElement('img');
                if (content.poster_path == null) {
                    $img.src =  '../image/notready.png';
                } else {
                    $img.src = `https://image.tmdb.org/t/p/w500/${content.poster_path}`;
                }
                const textNode = document.createTextNode(content.title);
                
                $a.append($img);
                $a.append(textNode);
                $li.append($a);
                $fragment.append($li);
                $result_contents.append($fragment);
            });
        } catch (err) {
            console.log('[ERROR]' + err);
        }
    }
    getMovieList();
    const render = async () => {
        try {
            const resContent = await fetch(          
                `https://api.themoviedb.org/3/search/multi?api_key=${api_key}&language=ko-KR&query=${$search_txt.value}&page=1&include_adult=false&region=KR`
            );
            const { results } = await resContent.json();
            movies.push($search_txt.value);
            const movieString = JSON.stringify(movies);
            localStorage.setItem(movies, movieString);
            //localStorage.getItem(obj_user);
            //console.log(obj_user);
            results.forEach(content => {
                const $li = document.createElement('li');
                $li.id = content.id;
                $li.className = content.media_type;
                const $a = document.createElement('a');
                $a.href = '#';
                const $img = document.createElement('img');
                if (content.poster_path == null) {
                    $img.src =  '../image/notready.png';
                } else {
                    $img.src = `https://image.tmdb.org/t/p/w500/${content.poster_path}`;
                }
                const textNode = document.createTextNode(content.title);
                
                $a.append($img);
                $a.append(textNode);
                $li.append($a);
                $fragment.append($li);
                $result_contents.append($fragment);
            });
        } catch (err) {
            console.log('[ERROR]' + err);
        }
    };
</script>
</html>
